# Безопасное REST API с интеграцией CI/CD

Это реализация безопасного REST API на Python с интегрированным CI/CD пайплайном для сканирования безопасности. Проект демонстрирует лучшие практики защиты веб-приложений от распространенных уязвимостей, перечисленных в OWASP Top 10.

## Запуск
```bash
docker-compose up -d
```
```bash
source venv/bin/activate
```

## Возможности

- Аутентификация пользователей с помощью JWT токенов
- CRUD операции для задач
- Защита от SQL-инъекций (SQLi)
- Защита от межсайтового скриптинга (XSS)
- Безопасное хранение паролей с хешированием
- CI/CD пайплайн с автоматизированным сканированием безопасности

## Используемые технологии

- Python 3.x
- Веб-фреймворк Flask
- ORM SQLAlchemy для работы с базой данных
- Flask-JWT-Extended для управления JWT токенами
- Marshmallow для валидации данных
- Bleach для защиты от XSS
- Bandit для SAST сканирования безопасности
- Safety для SCA проверки зависимостей
- GitHub Actions для CI/CD

## Структура проекта

```
lab1/
├── app.py                 # Главная точка входа приложения
├── requirements.txt       # Зависимости проекта
├── app/
│   ├── config.py          # Конфигурация приложения
│   ├── database.py        # Инициализация базы данных
│   ├── api/               # Обработчики API endpoint'ов
│   │   ├── auth.py        # Endpoint'ы аутентификации
│   │   └── data.py        # Endpoint'ы управления данными
│   ├── models/            # Модели базы данных
│   │   ├── user.py        # Модель пользователя
│   │   └── task.py        # Модель задачи
│   ├── schemas/           # Схемы валидации данных
│   │   ├── auth.py        # Схемы данных аутентификации
│   │   └── task.py        # Схемы данных задач
│   ├── core/              # Бизнес-логика
│   └── utils/             # Вспомогательные функции
└── .github/workflows/     # Конфигурация CI/CD пайплайна
    └── ci.yml             # Workflow сканирования безопасности
```

## Реализованные меры безопасности

### 1. Защита от SQL-инъекций (SQLi)
- Использование SQLAlchemy ORM для всех операций с базой данных
- Отсутствие сырых SQL запросов или конкатенации строк для построения запросов
- Параметризованные запросы через методы ORM

### 2. Защита от межсайтового скриптинга (XSS)
- Все пользовательские вводы санируются с помощью библиотеки Bleach
- Кодирование вывода при возврате данных в API ответах
- Заголовки политики безопасности контента

### 3. Безопасная аутентификация
- JWT токены для бессостоятельной аутентификации
- Хеширование паролей с использованием утилит безопасности Werkzeug
- Механизмы истечения срока действия и обновления токенов
- Безопасное хранение секретов и ключей

### 4. Валидация ввода
- Валидация данных с использованием схем Marshmallow
- Проверка типов и ограничений длины
- Валидация обязательных полей

## API Endpoint'ы

### Аутентификация
- `POST /auth/sign-in` - Аутентификация пользователя и получение JWT токена
- `POST /auth/sign-up` - Регистрация нового пользователя

### Управление данными
- `GET /api/data/` - Получение всех задач (требуется аутентификация)
- `GET /api/data/<id>` - Получение конкретной задачи (требуется аутентификация)
- `POST /api/data/` - Создание новой задачи (требуется аутентификация)
- `PUT /api/data/<id>` - Обновление существующей задачи (требуется аутентификация)
- `DELETE /api/data/<id>` - Удаление задачи (требуется аутентификация)

## Установка и настройка

1. Клонируйте репозиторий:
   ```bash
   git clone <url-репозитория>
   cd lab1/lab1
   ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # В Windows: venv\Scripts\activate
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Запустите приложение:
   ```bash
   python app.py
   ```

API будет доступен по адресу `http://localhost:5000`.

## CI/CD Пайплайн

Проект включает GitHub Actions workflow, который запускается при каждом push и pull request:

1. **SAST (Статический анализ безопасности приложений)**:
   - Bandit сканирует код на наличие распространенных проблем безопасности
   - Генерирует JSON отчеты о находках

2. **SCA (Анализ состава программного обеспечения)**:
   - Safety проверяет зависимости на наличие известных уязвимостей
   - Генерирует JSON отчеты о находках

Отчеты загружаются как артефакты и могут быть скачаны для просмотра.

## Тестирование API

Вы можете протестировать API с помощью curl или инструмента типа Postman:

1. Регистрация нового пользователя:
   ```bash
   curl -X POST http://localhost:5000/auth/sign-up \
        -H "Content-Type: application/json" \
        -d '{"username": "testuser", "password": "securepassword"}'
   ```

2. Вход для получения токена:
   ```bash
   curl -X POST http://localhost:5000/auth/sign-in \
        -H "Content-Type: application/json" \
        -d '{"username": "testuser", "password": "securepassword"}'
   ```

3. Использование токена для доступа к защищенным endpoint'ам:
   ```bash
   curl -X GET http://localhost:5000/api/data/ \
        -H "Authorization: Bearer <ваш-токен-здесь>"
   ```

## Отчеты о безопасности

После выполнения CI/CD пайплайна вы можете скачать отчеты о безопасности из артефактов GitHub Actions:
- `bandit-security-report`: Результаты SAST сканирования Bandit
- `safety-dependency-report`: Результаты SCA сканирования Safety

Эти отчеты покажут все проблемы безопасности, найденные в процессе сканирования.
